# Terraform AWS Infrastructure Setup

This project deploys a modular AWS infrastructure with Terraform, including:

- A VPC with public and private subnets
- 3 EC2 instances running Ubuntu 24.04:
  - 1 Jumpbox in a public subnet
  - 2 Nodes in private subnets (for Kubernetes cluster setup later)
- A Network Load Balancer exposing ports 80 and 443 to the private nodes

---

## Prerequisites

- AWS CLI configured with appropriate credentials
- Terraform installed (version >= 1.0 recommended)
- An existing SSH key pair in your AWS region (for EC2 key_name variable)

---

## Deployment

1. **Initialize Terraform**


terraform init
Review the execution plan


terraform plan -out=tfplan
Apply the plan


terraform apply tfplan
Outputs
After deployment, Terraform outputs the following:

jumpbox_public_ip: Public IP of the jumpbox EC2 instance to access the environment

You can also retrieve the IDs and IP addresses of all nodes using AWS CLI if needed.

Accessing the Jumpbox
Use the following command to SSH into the jumpbox instance:


ssh -i /path/to/your/private-key.pem ubuntu@52.19.79.67
Replace 52.19.79.67 with the value from the Terraform output.

Teardown
To destroy all resources created by Terraform, run:


terraform destroy
Notes
The private nodes do not have public IPs and are intended to be accessed via the jumpbox.

The Network Load Balancer exposes ports 80 and 443 to route traffic to the private nodes.

Example Outputs (from last apply)

jumpbox_public_ip = "52.19.79.67"
Troubleshooting
Ensure your AWS CLI user has permissions to create VPCs, EC2 instances, load balancers, and related resources.
ubuntu@ip-172-18-0-82:~/task1-terraform$ aws elbv2 describe-load-balancers   --query "LoadBalancers[?LoadBalancerName=='k8s-nlb']"   --output table
-----------------------------------------------------------------------------------------------------------------------------------
|                                                      DescribeLoadBalancers                                                      |
+------------------------------+--------------------------------------------------------------------------------------------------+
|  CanonicalHostedZoneId       |  Z2IFOLAFXWLO4F                                                                                  |
|  CreatedTime                 |  2025-08-02T12:33:38.865000+00:00                                                                |
|  DNSName                     |  k8s-nlb-695a3267d3dfd43c.elb.eu-west-1.amazonaws.com                                            |
|  EnablePrefixForIpv6SourceNat|  off                                                                                             |
|  IpAddressType               |  ipv4                                                                                            |
|  LoadBalancerArn             |  arn:aws:elasticloadbalancing:eu-west-1:723307514167:loadbalancer/net/k8s-nlb/695a3267d3dfd43c   |
|  LoadBalancerName            |  k8s-nlb                                                                                         |
|  Scheme                      |  internet-facing                                                                                 |
|  Type                        |  network                                                                                         |
|  VpcId                       |  vpc-0c8dbd1495f10f1c0                                                                           |
+------------------------------+--------------------------------------------------------------------------------------------------+
||                                                       AvailabilityZones                                                       ||
|+-------------------------------------+-----------------------------------------------------------------------------------------+|
||  SubnetId                           |  subnet-04b047ae6af4c003c                                                               ||
||  ZoneName                           |  eu-west-1b                                                                             ||
|+-------------------------------------+-----------------------------------------------------------------------------------------+|
||                                                       AvailabilityZones                                                       ||
|+-------------------------------------+-----------------------------------------------------------------------------------------+|
||  SubnetId                           |  subnet-04b1c48124e63c3da                                                               ||
||  ZoneName                           |  eu-west-1a                                                                             ||
|+-------------------------------------+-----------------------------------------------------------------------------------------+|
||                                                             State                                                             ||
|+-------------------------------------------------------+-----------------------------------------------------------------------+|
||  Code                                                 |  active                                                               ||
|+-------------------------------------------------------+-----------------------------------------------------------------------+|
ubuntu@ip-172-18-0-82:~/task1-terraform$ aws ec2 describe-instances --query "Reservations[*].Instances[*].[InstanceId,InstanceType,State.Name,SubnetId,PrivateIpAddress,PublicIpAddress,Tags[?Key=='Name'].Val
-----------------------------------------------------------------------------------------------------------------------------
|                                                     DescribeInstances                                                     |
+---------------------+------------+----------+---------------------------+-----------------+----------------+--------------+
|  i-06f52df148e168ad3|  t3.medium |  running |  subnet-04b1c48124e63c3da |  172.18.1.169   |  52.19.79.67   |  jumpbox     |
|  i-03c4db6409a772773|  t3.medium |  running |  subnet-09a598f8368b6ed94 |  172.18.101.70  |  None          |  k8s-node-1  |
|  i-0954682c9f59b3cb4|  t3.medium |  running |  subnet-07a68b7dba29e7f94 |  172.18.0.82    |  3.248.170.28  |              |
|  i-0280f573095de71bc|  t3.medium |  running |  subnet-098a26767eac0747d |  172.18.102.236 |  None          |  k8s-node-2  |
+---------------------+------------+----------+---------------------------+-----------------+----------------+--------------+


Check security group rules if you cannot SSH or access services.

aws ec2 describe-security-groups --region eu-west-1 --output table > describe-security-groups
ubuntu@ip-172-18-0-82:~/task1-terraform$ cat describe-security-groups
--------------------------------------------------------------------------------------------------
|                                     DescribeSecurityGroups                                     |
+------------------------------------------------------------------------------------------------+
||                                        SecurityGroups                                        ||
|+------------------+---------------------------------------------------------------------------+|
||  Description     |  Security group for candidate-test VM                                     ||
||  GroupId         |  sg-0a4a69c9c3076b210                                                     ||
||  GroupName       |  candidate-test-vm-sg                                                     ||
||  OwnerId         |  723307514167                                                             ||
||  SecurityGroupArn|  arn:aws:ec2:eu-west-1:723307514167:security-group/sg-0a4a69c9c3076b210   ||
||  VpcId           |  vpc-03a7d426733030e23                                                    ||
|+------------------+---------------------------------------------------------------------------+|
|||                                        IpPermissions                                       |||
||+-------------------------------------------------------------+------------------------------+||
|||  FromPort                                                   |  80                          |||
|||  IpProtocol                                                 |  tcp                         |||
|||  ToPort                                                     |  80                          |||
||+-------------------------------------------------------------+------------------------------+||
||||                                         IpRanges                                         ||||
|||+------------------------------------+-----------------------------------------------------+|||
||||  CidrIp                            |  0.0.0.0/0                                          ||||
||||  Description                       |  Allow HTTP access                                  ||||
|||+------------------------------------+-----------------------------------------------------+|||
||||                                        Ipv6Ranges                                        ||||
|||+------------------------------------+-----------------------------------------------------+|||
||||  CidrIpv6                          |  ::/0                                               ||||
||||  Description                       |  Allow HTTP access                                  ||||
|||+------------------------------------+-----------------------------------------------------+|||
|||                                        IpPermissions                                       |||
||+-------------------------------------------------------------+------------------------------+||
|||  FromPort                                                   |  22                          |||
|||  IpProtocol                                                 |  tcp                         |||
|||  ToPort                                                     |  22                          |||
||+-------------------------------------------------------------+------------------------------+||
||||                                         IpRanges                                         ||||
|||+-------------------------------------+----------------------------------------------------+|||
||||  CidrIp                             |  0.0.0.0/0                                         ||||
||||  Description                        |  Allow SSH access                                  ||||
|||+-------------------------------------+----------------------------------------------------+|||
||||                                        Ipv6Ranges                                        ||||
|||+-------------------------------------+----------------------------------------------------+|||
||||  CidrIpv6                           |  ::/0                                              ||||
||||  Description                        |  Allow SSH access                                  ||||
|||+-------------------------------------+----------------------------------------------------+|||
|||                                        IpPermissions                                       |||
||+-------------------------------------------------------------+------------------------------+||
|||  FromPort                                                   |  443                         |||
|||  IpProtocol                                                 |  tcp                         |||
|||  ToPort                                                     |  443                         |||
||+-------------------------------------------------------------+------------------------------+||
||||                                         IpRanges                                         ||||
|||+-----------------------------------+------------------------------------------------------+|||
||||  CidrIp                           |  0.0.0.0/0                                           ||||
||||  Description                      |  Allow HTTPS access                                  ||||
|||+-----------------------------------+------------------------------------------------------+|||
||||                                        Ipv6Ranges                                        ||||
|||+-----------------------------------+------------------------------------------------------+|||
||||  CidrIpv6                         |  ::/0                                                ||||
||||  Description                      |  Allow HTTPS access                                  ||||
|||+-----------------------------------+------------------------------------------------------+|||
|||                                     IpPermissionsEgress                                    |||
||+----------------------------------------------------------------+---------------------------+||
|||  IpProtocol                                                    |  -1                       |||
||+----------------------------------------------------------------+---------------------------+||
||||                                         IpRanges                                         ||||
|||+-----------------------------+------------------------------------------------------------+|||
||||  CidrIp                     |  0.0.0.0/0                                                 ||||
||||  Description                |  Allow all outbound traffic                                ||||
|||+-----------------------------+------------------------------------------------------------+|||
||||                                        Ipv6Ranges                                        ||||
|||+-----------------------------+------------------------------------------------------------+|||
||||  CidrIpv6                   |  ::/0                                                      ||||
||||  Description                |  Allow all outbound traffic                                ||||
|||+-----------------------------+------------------------------------------------------------+|||
|||                                            Tags                                            |||
||+--------------------------------------+-----------------------------------------------------+||
|||                  Key                 |                        Value                        |||
||+--------------------------------------+-----------------------------------------------------+||
|||  Environment                         |  candidate-test                                     |||
|||  IoTDesignation                      |  V3                                                 |||
|||  IoTTenant                           |  shared                                             |||
|||  managed-by                          |  terraform                                          |||
|||  Name                                |  candidate-test-vm-sg                               |||
||+--------------------------------------+-----------------------------------------------------+||
||                                        SecurityGroups                                        ||
|+------------------+---------------------------------------------------------------------------+|
||  Description     |  default VPC security group                                               ||
||  GroupId         |  sg-06d26376ed4362ce8                                                     ||
||  GroupName       |  default                                                                  ||
||  OwnerId         |  723307514167                                                             ||
||  SecurityGroupArn|  arn:aws:ec2:eu-west-1:723307514167:security-group/sg-06d26376ed4362ce8   ||
||  VpcId           |  vpc-03a7d426733030e23                                                    ||
|+------------------+---------------------------------------------------------------------------+|
|||                                        IpPermissions                                       |||
||+----------------------------------------------------------------+---------------------------+||
|||  IpProtocol                                                    |  -1                       |||
||+----------------------------------------------------------------+---------------------------+||
||||                                     UserIdGroupPairs                                     ||||
|||+---------------------------+--------------------------------------------------------------+|||
||||  GroupId                  |  sg-06d26376ed4362ce8                                        ||||
||||  UserId                   |  723307514167                                                ||||
|||+---------------------------+--------------------------------------------------------------+|||
|||                                     IpPermissionsEgress                                    |||
||+----------------------------------------------------------------+---------------------------+||
|||  IpProtocol                                                    |  -1                       |||
||+----------------------------------------------------------------+---------------------------+||
||||                                         IpRanges                                         ||||
|||+--------------------------------------+---------------------------------------------------+|||
||||  CidrIp                              |  0.0.0.0/0                                        ||||
|||+--------------------------------------+---------------------------------------------------+|||
||||                                        Ipv6Ranges                                        ||||
|||+-----------------------------------------------------+------------------------------------+|||
||||  CidrIpv6                                           |  ::/0                              ||||
|||+-----------------------------------------------------+------------------------------------+|||
||                                        SecurityGroups                                        ||
|+------------------+---------------------------------------------------------------------------+|
||  Description     |  Allow SSH from my IP                                                     ||
||  GroupId         |  sg-0a022814ae8267e40                                                     ||
||  GroupName       |  jumpbox-sg                                                               ||
||  OwnerId         |  723307514167                                                             ||
||  SecurityGroupArn|  arn:aws:ec2:eu-west-1:723307514167:security-group/sg-0a022814ae8267e40   ||
||  VpcId           |  vpc-0c8dbd1495f10f1c0                                                    ||
|+------------------+---------------------------------------------------------------------------+|
|||                                        IpPermissions                                       |||
||+-------------------------------------------------------------+------------------------------+||
|||  FromPort                                                   |  22                          |||
|||  IpProtocol                                                 |  tcp                         |||
|||  ToPort                                                     |  22                          |||
||+-------------------------------------------------------------+------------------------------+||
||||                                         IpRanges                                         ||||
|||+---------------------------------------+--------------------------------------------------+|||
||||  CidrIp                               |  3.248.170.28/32                                 ||||
||||  Description                          |  SSH from my IP                                  ||||
|||+---------------------------------------+--------------------------------------------------+|||
|||                                     IpPermissionsEgress                                    |||
||+----------------------------------------------------------------+---------------------------+||
|||  IpProtocol                                                    |  -1                       |||
||+----------------------------------------------------------------+---------------------------+||
||||                                         IpRanges                                         ||||
|||+--------------------------------------+---------------------------------------------------+|||
||||  CidrIp                              |  0.0.0.0/0                                        ||||
|||+--------------------------------------+---------------------------------------------------+|||
||                                        SecurityGroups                                        ||
|+------------------+---------------------------------------------------------------------------+|
||  Description     |  default VPC security group                                               ||
||  GroupId         |  sg-094b3f2604fc5cf91                                                     ||
||  GroupName       |  default                                                                  ||
||  OwnerId         |  723307514167                                                             ||
||  SecurityGroupArn|  arn:aws:ec2:eu-west-1:723307514167:security-group/sg-094b3f2604fc5cf91   ||
||  VpcId           |  vpc-0c8dbd1495f10f1c0                                                    ||
|+------------------+---------------------------------------------------------------------------+|
|||                                        IpPermissions                                       |||
||+----------------------------------------------------------------+---------------------------+||
|||  IpProtocol                                                    |  -1                       |||
||+----------------------------------------------------------------+---------------------------+||
||||                                     UserIdGroupPairs                                     ||||
|||+---------------------------+--------------------------------------------------------------+|||
||||  GroupId                  |  sg-094b3f2604fc5cf91                                        ||||
||||  UserId                   |  723307514167                                                ||||
|||+---------------------------+--------------------------------------------------------------+|||
|||                                     IpPermissionsEgress                                    |||
||+----------------------------------------------------------------+---------------------------+||
|||  IpProtocol                                                    |  -1                       |||
||+----------------------------------------------------------------+---------------------------+||
||||                                         IpRanges                                         ||||
|||+--------------------------------------+---------------------------------------------------+|||
||||  CidrIp                              |  0.0.0.0/0                                        ||||
|||+--------------------------------------+---------------------------------------------------+|||
||                                        SecurityGroups                                        ||
|+------------------+---------------------------------------------------------------------------+|
||  Description     |  K8s nodes security group                                                 ||
||  GroupId         |  sg-0c6aa9f7d3d6b5a82                                                     ||
||  GroupName       |  nodes-sg                                                                 ||
||  OwnerId         |  723307514167                                                             ||
||  SecurityGroupArn|  arn:aws:ec2:eu-west-1:723307514167:security-group/sg-0c6aa9f7d3d6b5a82   ||
||  VpcId           |  vpc-0c8dbd1495f10f1c0                                                    ||
|+------------------+---------------------------------------------------------------------------+|
|||                                        IpPermissions                                       |||
||+-------------------------------------------------------------+------------------------------+||
|||  FromPort                                                   |  80                          |||
|||  IpProtocol                                                 |  tcp                         |||
|||  ToPort                                                     |  80                          |||
||+-------------------------------------------------------------+------------------------------+||
||||                                         IpRanges                                         ||||
|||+-----------------------------------+------------------------------------------------------+|||
||||  CidrIp                           |  0.0.0.0/0                                           ||||
||||  Description                      |  HTTP from anywhere                                  ||||
|||+-----------------------------------+------------------------------------------------------+|||
|||                                        IpPermissions                                       |||
||+-------------------------------------------------------+------------------------------------+||
|||  FromPort                                             |  30000                             |||
|||  IpProtocol                                           |  tcp                               |||
|||  ToPort                                               |  32767                             |||
||+-------------------------------------------------------+------------------------------------+||
||||                                         IpRanges                                         ||||
|||+-----------------------------+------------------------------------------------------------+|||
||||  CidrIp                     |  172.18.0.0/16                                             ||||
||||  Description                |  Kubernetes NodePorts range                                ||||
|||+-----------------------------+------------------------------------------------------------+|||
|||                                        IpPermissions                                       |||
||+----------------------------------------------------------+---------------------------------+||
|||  FromPort                                                |  6443                           |||
|||  IpProtocol                                              |  tcp                            |||
|||  ToPort                                                  |  6443                           |||
||+----------------------------------------------------------+---------------------------------+||
||||                                         IpRanges                                         ||||
|||+---------------------------+--------------------------------------------------------------+|||
||||  CidrIp                   |  172.18.0.0/16                                               ||||
||||  Description              |  Kubernetes API and NodePorts                                ||||
|||+---------------------------+--------------------------------------------------------------+|||
|||                                        IpPermissions                                       |||
||+----------------------------------------------------------------+---------------------------+||
|||  FromPort                                                      |                           |||
|||  IpProtocol                                                    |  -1                       |||
|||  ToPort                                                        |                           |||
||+----------------------------------------------------------------+---------------------------+||
||||                                     UserIdGroupPairs                                     ||||
|||+-----------------------+------------------------------------------------------------------+|||
||||  Description          |  All traffic from same security group                            ||||
||||  GroupId              |  sg-0c6aa9f7d3d6b5a82                                            ||||
||||  UserId               |  723307514167                                                    ||||
|||+-----------------------+------------------------------------------------------------------+|||
|||                                        IpPermissions                                       |||
||+-------------------------------------------------------------+------------------------------+||
|||  FromPort                                                   |  22                          |||
|||  IpProtocol                                                 |  tcp                         |||
|||  ToPort                                                     |  22                          |||
||+-------------------------------------------------------------+------------------------------+||
||||                                     UserIdGroupPairs                                     ||||
|||+---------------------------------+--------------------------------------------------------+|||
||||  Description                    |  SSH from jumpbox                                      ||||
||||  GroupId                        |  sg-0a022814ae8267e40                                  ||||
||||  UserId                         |  723307514167                                          ||||
|||+---------------------------------+--------------------------------------------------------+|||
|||                                        IpPermissions                                       |||
||+-------------------------------------------------------------+------------------------------+||
|||  FromPort                                                   |  443                         |||
|||  IpProtocol                                                 |  tcp                         |||
|||  ToPort                                                     |  443                         |||
||+-------------------------------------------------------------+------------------------------+||
||||                                         IpRanges                                         ||||
|||+----------------------------------+-------------------------------------------------------+|||
||||  CidrIp                          |  0.0.0.0/0                                            ||||
||||  Description                     |  HTTPS from anywhere                                  ||||
|||+----------------------------------+-------------------------------------------------------+|||
|||                                     IpPermissionsEgress                                    |||
||+----------------------------------------------------------------+---------------------------+||
|||  IpProtocol                                                    |  -1                       |||
||+----------------------------------------------------------------+---------------------------+||
||||                                         IpRanges                                         ||||
|||+--------------------------------------+---------------------------------------------------+|||
||||  CidrIp                              |  0.0.0.0/0                                        ||||
|||+--------------------------------------+---------------------------------------------------+|||
